# =================================================================
# [í•„ìˆ˜ ìƒìˆ˜ ì •ì˜] - analysis_core_final.pyê°€ ì°¸ì¡°í•˜ëŠ” í•µì‹¬ ë°ì´í„°
# =================================================================

# 1. 10ì²œê°„ (åå¤©å¹²)
CHEONGAN = ['ç”²', 'ä¹™', 'ä¸™', 'ä¸', 'æˆŠ', 'å·±', 'åºš', 'è¾›', 'å£¬', 'ç™¸']

# 2. 12ì§€ì§€ (åäºŒåœ°æ”¯)
JIJI = ['å­', 'ä¸‘', 'å¯…', 'å¯', 'è¾°', 'å·³', 'åˆ', 'æœª', 'ç”³', 'é…‰', 'æˆŒ', 'äº¥']

# 3. 60ê°‘ì (å…­åç”²å­)
GANJI = [
    'ç”²å­', 'ä¹™ä¸‘', 'ä¸™å¯…', 'ä¸å¯', 'æˆŠè¾°', 'å·±å·³', 'åºšåˆ', 'è¾›æœª', 'å£¬ç”³', 'ç™¸é…‰',
    'ç”²æˆŒ', 'ä¹™äº¥', 'ä¸™å­', 'ä¸ä¸‘', 'æˆŠå¯…', 'å·±å¯', 'åºšè¾°', 'è¾›å·³', 'å£¬åˆ', 'ç™¸æœª',
    'ç”²ç”³', 'ä¹™é…‰', 'ä¸™æˆŒ', 'ä¸äº¥', 'æˆŠå­', 'å·±ä¸‘', 'åºšå¯…', 'è¾›å¯', 'å£¬è¾°', 'ç™¸å·³',
    'ç”²åˆ', 'ä¹™æœª', 'ä¸™ç”³', 'ä¸é…‰', 'æˆŠæˆŒ', 'å·±äº¥', 'åºšå­', 'è¾›ä¸‘', 'å£¬å¯…', 'ç™¸å¯',
    'ç”²è¾°', 'ä¹™å·³', 'ä¸™åˆ', 'ä¸æœª', 'æˆŠç”³', 'å·±é…‰', 'åºšæˆŒ', 'è¾›äº¥', 'å£¬å­', 'ç™¸ä¸‘'
]

# 4. ì›”ë‘ë²• ìƒìˆ˜ (ë…„ê°„ ê¸°ì¤€ ì›”ê°„ ì‹œì‘ ì²œê°„ ì¸ë±ìŠ¤)
# (ç”²å·±:ä¸™å¯…, ä¹™åºš:æˆŠå¯…, ä¸™è¾›:åºšå¯…, ä¸å£¬:å£¬å¯…, æˆŠç™¸:ç”²å¯…)
YEAR_STEM_TO_MONTH_STEM_INDEX = {
    'ç”²': 2, 'å·±': 2, # ä¸™å¯… ì‹œì‘ (ä¸™ì˜ ì¸ë±ìŠ¤)
    'ä¹™': 4, 'åºš': 4, # æˆŠå¯… ì‹œì‘
    'ä¸™': 6, 'è¾›': 6, # åºšå¯… ì‹œì‘
    'ä¸': 8, 'å£¬': 8, # å£¬å¯… ì‹œì‘
    'æˆŠ': 0, 'ç™¸': 0  # ç”²å¯… ì‹œì‘
}

# 5. ì˜¤í–‰ ë§µ (ê°„ë‹¨ ë²„ì „, ì˜¤ë¥˜ ë°©ì§€ìš©)
O_HAENG_MAP = {
    'ç”²': 'æœ¨', 'ä¹™': 'æœ¨', 'ä¸™': 'ç«', 'ä¸': 'ç«', 'æˆŠ': 'åœŸ', 
    'å·±': 'åœŸ', 'åºš': 'é‡‘', 'è¾›': 'é‡‘', 'å£¬': 'æ°´', 'ç™¸': 'æ°´', 
    'å­': 'æ°´', 'ä¸‘': 'åœŸ', 'å¯…': 'æœ¨', 'å¯': 'æœ¨', 'è¾°': 'åœŸ', 
    'å·³': 'ç«', 'åˆ': 'ç«', 'æœª': 'åœŸ', 'ç”³': 'é‡‘', 'é…‰': 'é‡‘', 
    'æˆŒ': 'åœŸ', 'äº¥': 'æ°´'
}

# saju_data.py
# í¬êµ¬ì†Œ(Hidden Luck Lab) ì‚¬ì£¼ ë°ì´í„° ëª¨ë“ˆ
# ì—­í• : ë§Œì„¸ë ¥ ê³„ì‚° ë° ë¶„ì„ì— í•„ìš”í•œ ëª¨ë“  ìƒìˆ˜ì™€ ì»¤ìŠ¤í„°ë§ˆì´ì§•ëœ ì ìˆ˜ ë° ê·œì¹™ì„ ë³´ê´€í•©ë‹ˆë‹¤.
# ì´ íŒŒì¼ì€ CSV íŒŒì¼ ì—†ì´ ë…ë¦½ì ìœ¼ë¡œ ì‘ë™í•˜ë„ë¡ ëª¨ë“  ì ìˆ˜í‘œ(ë”•ì…”ë„ˆë¦¬)ë¥¼ ë‚´ì¥í•©ë‹ˆë‹¤.

# 1. ê¸°ë³¸ ë§¤í•‘ ìƒìˆ˜
CHEONGAN = ["ç”²", "ä¹™", "ä¸™", "ä¸", "æˆŠ", "å·±", "åºš", "è¾›", "å£¬", "ç™¸"]
JIJI = ["å­", "ä¸‘", "å¯…", "å¯", "è¾°", "å·³", "åˆ", "æœª", "ç”³", "é…‰", "æˆŒ", "äº¥"]
GANJI_60 = [c + j for c in CHEONGAN for j in JIJI][:60]

# DAY_STEM_TO_TIME_STEM_START_INDEX: ì¼ê°„ì„ ê¸°ì¤€ìœ¼ë¡œ å­æ™‚(ìì‹œ)ì˜ ì²œê°„ ì¸ë±ìŠ¤ (ç”²=0)
# (ç”²å·±:ç”², ä¹™åºš:ä¸™, ä¸™è¾›:æˆŠ, ä¸å£¬:åºš, æˆŠç™¸:å£¬)
DAY_STEM_TO_TIME_STEM_START_INDEX = {
    'ç”²': 0, # ç”²å­æ™‚ ì‹œì‘ (ç”²ì˜ ì¸ë±ìŠ¤)
    'ä¹™': 2, # ä¸™å­æ™‚ ì‹œì‘ (ä¸™ì˜ ì¸ë±ìŠ¤)
    'ä¸™': 4, # æˆŠå­æ™‚ ì‹œì‘ (æˆŠì˜ ì¸ë±ìŠ¤)
    'ä¸': 6, # åºšå­æ™‚ ì‹œì‘ (åºšì˜ ì¸ë±ìŠ¤)
    'æˆŠ': 8, # å£¬å­æ™‚ ì‹œì‘ (å£¬ì˜ ì¸ë±ìŠ¤)
    'å·±': 0, # ç”²å­æ™‚ ì‹œì‘
    'åºš': 2, # ä¸™å­æ™‚ ì‹œì‘
    'è¾›': 4, # æˆŠå­æ™‚ ì‹œì‘
    'å£¬': 6, # åºšå­æ™‚ ì‹œì‘
    'ç™¸': 8, # å£¬å­æ™‚ ì‹œì‘
}

# 2. ì¼ê°„ë³„ ë§ì¶¤ ë¬¸ì²´ (Persona) - ê¸°ì¡´ ë‚´ìš© ìœ ì§€
TEN_GAN_PERSONA = {
    "ç”²": {"style": "ì§ì§„í•˜ëŠ” ìš©ê¸°ì™€ ê°•í•œ ì„±ì¥ì˜ í˜! ìƒˆë¡œìš´ ì‹œì‘ì„ ìì‹  ìˆê²Œ ì‘ì›í•©ë‹ˆë‹¤.", "instruction": "ì²­ì(User)ëŠ” 'ê°‘ëª©(ç”²)' ì„±í–¥ì…ë‹ˆë‹¤. ì„œë¡ ì„ ê¸¸ê²Œ ëŒì§€ ë§ê³ , ë‘ê´„ì‹ìœ¼ë¡œ ì§„ì·¨ì ì¸ ë¹„ì „ì„ ì œì‹œí•˜ì„¸ìš”. 'ì„±ì¥', 'ì‹œì‘', 'ë„ì „'ê³¼ ê°™ì€ ê¸ì •ì ì´ê³  ë¯¸ë˜ì§€í–¥ì ì¸ ì–´íœ˜ë¥¼ ì‚¬ìš©í•˜ê³ , ë§ì„¤ì„ ì—†ì´ ë“±ì„ ë– ë°€ì–´ì£¼ëŠ” í˜ì°¬ ì–´ì¡°ë¥¼ ìœ ì§€í•˜ì„¸ìš”."},
    "ä¹™": {"style": "ë”°ëœ»í•œ ë§ˆìŒê³¼ ë°°ë ¤, ëª¨ë‘ì˜ í–‰ë³µì„ ì±™ê¸°ëŠ” ëª¨ìŠµì´ ì¸ìƒì ì´ì—ìš”.", "instruction": "ì²­ì(User)ëŠ” 'ì„ëª©(ä¹™)' ì„±í–¥ì…ë‹ˆë‹¤. ë¶€ë“œëŸ¬ìš´ ì–¸ì–´ë¥¼ ì‚¬ìš©í•˜ë˜, í•µì‹¬ ë©”ì‹œì§€ëŠ” í™•ê³ í•˜ê³  ì •í™•í•˜ê²Œ ì „ë‹¬í•˜ì„¸ìš”. 'ì—°ê²°', 'ìœ ì—°ì„±', 'ì¡°í™”' ê°™ì€ ì–´íœ˜ë¥¼ ì‚¬ìš©í•˜ë©°, ì£¼ë³€ì˜ ë„ì›€ì„ í™œìš©í•˜ëŠ” ë°©ë²•ì„ êµ¬ì²´ì ìœ¼ë¡œ ì¡°ì–¸í•˜ì„¸ìš”."},
    "ä¸™": {"style": "ë°ê³  ê¸ì •ì ì¸ ì—ë„ˆì§€ë¡œ ì£¼ë³€ì„ í™˜í•˜ê²Œ ë§Œë“œëŠ” íƒœì–‘ì´ë„¤ìš”.", "instruction": "ì²­ì(User)ëŠ” 'ë³‘í™”(ä¸™)' ì„±í–¥ì…ë‹ˆë‹¤. ëª…ì¾Œí•˜ê³  ìì‹ ê° ë„˜ì¹˜ëŠ” ì–´ì¡°ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”. 'ë¹„ì „', 'í™•ì‚°', 'ë°ìŒ' ê°™ì€ ì–´íœ˜ë¥¼ í™œìš©í•˜ì—¬, ëŒ€ì¤‘ì  ì˜í–¥ë ¥ê³¼ ì‹œì•¼ í™•ì¥ì— ì´ˆì ì„ ë§ì¶˜ ì¡°ì–¸ì„ ì œì‹œí•˜ì„¸ìš”."},
    "ä¸": {"style": "ì„¸ë°€í•œ í†µì°°ë ¥ê³¼ ê°•í•œ ì§‘ì¤‘ë ¥ìœ¼ë¡œ ë¹›ì„ ë§Œë“¤ì–´ë‚´ëŠ” ë¶„ì…ë‹ˆë‹¤.", "instruction": "ì²­ì(User)ëŠ” 'ì •í™”(ä¸)' ì„±í–¥ì…ë‹ˆë‹¤. ì‚¬ë ¤ ê¹Šì§€ë§Œ ê²°ë¡ ì€ ëª…í™•í•œ ì–´ì¡°ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”. 'ì§‘ì¤‘', 'í†µì°°', 'ì •ë°€í•¨' ê°™ì€ ì–´íœ˜ë¥¼ í™œìš©í•˜ì—¬, ë‚´ì‹¤ ë‹¤ì§€ê¸°ì™€ ì •í™•í•œ ëª©í‘œ ì„¤ì •ì˜ ì¤‘ìš”ì„±ì„ ê°•ì¡°í•˜ì„¸ìš”."},
    "æˆŠ": {"style": "ë¬µë¬µíˆ í° ê²ƒì„ ë‹´ì•„ë‚´ë©° ë¯¿ìŒì„ ì£¼ëŠ” ì•ˆì •ì ì¸ ì‚°ê³¼ ê°™ìŠµë‹ˆë‹¤.", "instruction": "ì²­ì(User)ëŠ” 'ë¬´í† (æˆŠ)' ì„±í–¥ì…ë‹ˆë‹¤. ì‹ ë¢°ê°ì„ ì£¼ëŠ” ë¬´ê²Œê° ìˆëŠ” ì–´ì¡°ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”. 'ì¤‘ì‹¬', 'ì•ˆì •', 'ì¶•ì ' ê°™ì€ ì–´íœ˜ë¥¼ í™œìš©í•˜ì—¬, ì¥ê¸°ì ì¸ ê³„íšê³¼ í”ë“¤ë¦¬ì§€ ì•ŠëŠ” ì¤‘ì‹¬ì„ ì¡ëŠ” ë°©ë²•ì„ ì¡°ì–¸í•˜ì„¸ìš”."},
    "å·±": {"style": "ì„¸ìƒì˜ ëª¨ë“  ê²ƒì„ í’ˆê³  í‚¤ì›Œë‚´ëŠ” í¬ìš©ë ¥ê³¼ ì‹¤ì§ˆì ì¸ í˜ì´ ìˆìŠµë‹ˆë‹¤.", "instruction": "ì²­ì(User)ëŠ” 'ê¸°í† (å·±)' ì„±í–¥ì…ë‹ˆë‹¤. ê³µê° ëŠ¥ë ¥ì´ ëŠê»´ì§€ëŠ” ì¹œê·¼í•œ ì–´ì¡°ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”. 'ì¡°ìœ¨', 'ì‹¤ì†', 'í¬ìš©' ê°™ì€ ì–´íœ˜ë¥¼ í™œìš©í•˜ì—¬, í˜„ì‹¤ì ì¸ ì´ìµê³¼ íƒ€ì¸ê³¼ì˜ ê´€ê³„ì—ì„œ ê· í˜•ì„ ì¡ëŠ” ë°©ë²•ì„ ì œì‹œí•˜ì„¸ìš”."},
    "åºš": {"style": "ê°•í•œ ì˜ì§€ì™€ ê²°ë‹¨ë ¥ìœ¼ë¡œ ëª©í‘œë¥¼ ìŸì·¨í•˜ëŠ” ê¸ˆì†ì˜ ë¦¬ë”ì‹­ì´ ìˆë„¤ìš”.", "instruction": "ì²­ì(User)ëŠ” 'ê²½ê¸ˆ(åºš)' ì„±í–¥ì…ë‹ˆë‹¤. ë‹¨í˜¸í•˜ê³  ë…¼ë¦¬ì ì¸ ì–´ì¡°ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”. 'ê°œí˜', 'ì‹¤í–‰', 'ê²°ë‹¨' ê°™ì€ ì–´íœ˜ë¥¼ í™œìš©í•˜ì—¬, ë¶ˆí•„ìš”í•œ ê²ƒì„ ì˜ë¼ë‚´ê³  í•µì‹¬ì— ì§‘ì¤‘í•˜ëŠ” ì „ëµì„ ê°•ì¡°í•˜ì„¸ìš”."},
    "è¾›": {"style": "ì„¸ìƒì— ê¼­ í•„ìš”í•œ ê°€ì¹˜ë¥¼ ë§Œë“¤ê³  ì„¸ë°€í•œ ì•„ë¦„ë‹¤ì›€ì„ ì™„ì„±í•˜ëŠ” ë³´ì„ì…ë‹ˆë‹¤.", "instruction": "ì²­ì(User)ëŠ” 'ì‹ ê¸ˆ(è¾›)' ì„±í–¥ì…ë‹ˆë‹¤. ì •ì œë˜ê³  ì„¬ì„¸í•œ ì–´ì¡°ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”. 'ê°€ì¹˜', 'ì •ë°€', 'ì™„ì„±' ê°™ì€ ì–´íœ˜ë¥¼ í™œìš©í•˜ì—¬, ì „ë¬¸ì„±ì„ ë†’ì´ê³  ìì‹ ì˜ ê°€ì¹˜ë¥¼ ì¸ì •ë°›ëŠ” ë°©ë²•ì„ êµ¬ì²´ì ìœ¼ë¡œ ì¡°ì–¸í•˜ì„¸ìš”."},
    "å£¬": {"style": "ë„“ì€ ì‹œì•¼ì™€ ìœ ì—°í•¨ìœ¼ë¡œ ì„¸ìƒì„ íƒí—˜í•˜ëŠ” ë°”ë‹¤ì™€ ê°™ìŠµë‹ˆë‹¤.", "instruction": "ì²­ì(User)ëŠ” 'ì„ìˆ˜(å£¬)' ì„±í–¥ì…ë‹ˆë‹¤. ì§€í˜œë¡­ê³  ê°œë°©ì ì¸ ì–´ì¡°ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”. 'ìŠ¤ì¼€ì¼', 'íë¦„', 'ì§€í˜œ' ê°™ì€ ì–´íœ˜ë¥¼ í™œìš©í•˜ì—¬, í° ê·¸ë¦¼ì„ ë³´ê³  ë‹¤ë°©ë©´ìœ¼ë¡œ ì •ë³´ë¥¼ ìˆ˜ì§‘í•˜ëŠ” ì „ëµì„ ì œì‹œí•˜ì„¸ìš”."},
    "ç™¸": {"style": "ì–´ë‘  ì†ì—ì„œë„ ìƒëª…ì„ í‚¤ì›Œë‚´ëŠ” ê¹Šì€ ì§€í˜œì™€ ì˜ê°ì„ ê°€ì§„ ë¶„ì…ë‹ˆë‹¤.", "instruction": "ì²­ì(User)ëŠ” 'ê³„ìˆ˜(ç™¸)' ì„±í–¥ì…ë‹ˆë‹¤. ì°¨ë¶„í•˜ê³  í†µì°°ë ¥ ìˆëŠ” ì–´ì¡°ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”. 'ì˜ê°', 'ì ì¬ë ¥', 'ì€ë°€í•¨' ê°™ì€ ì–´íœ˜ë¥¼ í™œìš©í•˜ì—¬, ì§ê´€ì„ ë”°ë¥´ê³  ë‚´ë©´ì˜ í˜ì„ ê¸°ë¥´ëŠ” ë°©ë²•ì„ ì¡°ì–¸í•˜ì„¸ìš”."},
}

# 3. ì‹­ì´ìš´ì„± (12-Star) - ê¸°ì¡´ ë‚´ìš© ìœ ì§€
TWELVE_STAR = ["ì¥ìƒ", "ëª©ìš•", "ê´€ëŒ€", "ê±´ë¡", "ì œì™•", "ì‡ ", "ë³‘", "ì‚¬", "ë¬˜", "ì ˆ", "íƒœ", "ì–‘"]


# ====================================================================================================
# [4. 'í¬êµ¬ì†Œ' AI ì‚¬ì£¼ ì ìˆ˜í™” ë¡œì§ (Scoring Tables & Functions)]
# ëª©í‘œ: ì»¤ìŠ¤í„°ë§ˆì´ì§•ëœ ì ìˆ˜ì™€ ê°€ì¤‘ì¹˜ë¥¼ ì ìš©í•˜ì—¬ ìš´ì„¸ ê·¸ë˜í”„ ê¸°ë°˜ ì ìˆ˜ ì‚°ì¶œ
# ğŸ”„ 2024.12 ì—…ë°ì´íŠ¸: ìƒˆë¡œìš´ ì ìˆ˜í‘œ + ì •ê·œí™” ë¡œì§ ì ìš©
# ====================================================================================================

# --------------------------------------------------------------------------------
# 4.1. ì ìˆ˜ í…Œì´ë¸” (Scoring Tables) - ì›ë³¸ ì ìˆ˜ ì €ì¥ (ì •ê·œí™”ëŠ” ê³„ì‚° ì‹œ ì ìš©)
# --------------------------------------------------------------------------------

# 1. ì²œê°„ ì ìˆ˜ í…Œì´ë¸” (ê³„íš, 20% ë¹„ì¤‘) - ì¼ê°„ vs. ìš´ì²œê°„ ìƒí˜¸ì‘ìš©
# ì›ë³¸ ì ìˆ˜ ë²”ìœ„: -10 ~ 100
CHUNGAN_SCORES_LOOKUP = {
    # ç”² ì¼ê°„
    ('ç”²', 'ç”²'): 45, ('ç”²', 'ä¹™'): 35, ('ç”²', 'ä¸™'): 100, ('ç”²', 'ä¸'): 50, ('ç”²', 'æˆŠ'): 80,
    ('ç”²', 'å·±'): -10, ('ç”²', 'åºš'): -10, ('ç”²', 'è¾›'): 40, ('ç”²', 'å£¬'): 35, ('ç”²', 'ç™¸'): 40,
    # ä¹™ ì¼ê°„
    ('ä¹™', 'ç”²'): 85, ('ä¹™', 'ä¹™'): 50, ('ä¹™', 'ä¸™'): 100, ('ä¹™', 'ä¸'): 50, ('ä¹™', 'æˆŠ'): 80,
    ('ä¹™', 'å·±'): 80, ('ä¹™', 'åºš'): -10, ('ä¹™', 'è¾›'): 35, ('ä¹™', 'å£¬'): 35, ('ä¹™', 'ç™¸'): 50,
    # ä¸™ ì¼ê°„
    ('ä¸™', 'ç”²'): 80, ('ä¸™', 'ä¹™'): 80, ('ä¸™', 'ä¸™'): 50, ('ä¸™', 'ä¸'): 50, ('ä¸™', 'æˆŠ'): 45,
    ('ä¸™', 'å·±'): 45, ('ä¸™', 'åºš'): 35, ('ä¸™', 'è¾›'): -10, ('ä¸™', 'å£¬'): 100, ('ä¸™', 'ç™¸'): 35,
    # ä¸ ì¼ê°„
    ('ä¸', 'ç”²'): 80, ('ä¸', 'ä¹™'): 80, ('ä¸', 'ä¸™'): 35, ('ä¸', 'ä¸'): 50, ('ä¸', 'æˆŠ'): 80,
    ('ä¸', 'å·±'): 80, ('ä¸', 'åºš'): 80, ('ä¸', 'è¾›'): -10, ('ä¸', 'å£¬'): -10, ('ä¸', 'ç™¸'): 35,
    # æˆŠ ì¼ê°„
    ('æˆŠ', 'ç”²'): 80, ('æˆŠ', 'ä¹™'): 35, ('æˆŠ', 'ä¸™'): 80, ('æˆŠ', 'ä¸'): 50, ('æˆŠ', 'æˆŠ'): 50,
    ('æˆŠ', 'å·±'): 35, ('æˆŠ', 'åºš'): 35, ('æˆŠ', 'è¾›'): 35, ('æˆŠ', 'å£¬'): 45, ('æˆŠ', 'ç™¸'): -10,
    # å·± ì¼ê°„
    ('å·±', 'ç”²'): 25, ('å·±', 'ä¹™'): 80, ('å·±', 'ä¸™'): 80, ('å·±', 'ä¸'): 80, ('å·±', 'æˆŠ'): 35,
    ('å·±', 'å·±'): 50, ('å·±', 'åºš'): 35, ('å·±', 'è¾›'): 35, ('å·±', 'å£¬'): 35, ('å·±', 'ç™¸'): 45,
    # åºš ì¼ê°„
    ('åºš', 'ç”²'): 80, ('åºš', 'ä¹™'): 25, ('åºš', 'ä¸™'): 80, ('åºš', 'ä¸'): 80, ('åºš', 'æˆŠ'): 80,
    ('åºš', 'å·±'): 80, ('åºš', 'åºš'): 50, ('åºš', 'è¾›'): 30, ('åºš', 'å£¬'): 80, ('åºš', 'ç™¸'): 50,
    # è¾› ì¼ê°„
    ('è¾›', 'ç”²'): 80, ('è¾›', 'ä¹™'): 80, ('è¾›', 'ä¸™'): -10, ('è¾›', 'ä¸'): -10, ('è¾›', 'æˆŠ'): 35,
    ('è¾›', 'å·±'): 45, ('è¾›', 'åºš'): 35, ('è¾›', 'è¾›'): 50, ('è¾›', 'å£¬'): 100, ('è¾›', 'ç™¸'): 80,
    # å£¬ ì¼ê°„
    ('å£¬', 'ç”²'): 45, ('å£¬', 'ä¹™'): 45, ('å£¬', 'ä¸™'): 80, ('å£¬', 'ä¸'): -10, ('å£¬', 'æˆŠ'): 50,
    ('å£¬', 'å·±'): 35, ('å£¬', 'åºš'): 80, ('å£¬', 'è¾›'): 35, ('å£¬', 'å£¬'): 50, ('å£¬', 'ç™¸'): 35,
    # ç™¸ ì¼ê°„
    ('ç™¸', 'ç”²'): 80, ('ç™¸', 'ä¹™'): 80, ('ç™¸', 'ä¸™'): 35, ('ç™¸', 'ä¸'): 50, ('ç™¸', 'æˆŠ'): 25,
    ('ç™¸', 'å·±'): 35, ('ç™¸', 'åºš'): 80, ('ç™¸', 'è¾›'): 35, ('ç™¸', 'å£¬'): 35, ('ç™¸', 'ç™¸'): 50,
}

# 2. ì§€ì§€ ì ìˆ˜ í…Œì´ë¸” (ê²°ê³¼, 30% ë¹„ì¤‘) - ì¼ì§€ vs. ìš´ì§€ì§€ ìƒí˜¸ì‘ìš©
# ì›ë³¸ ì ìˆ˜ ë²”ìœ„: -20 ~ 120
JIJI_SCORES_LOOKUP = {
    # å¯… ì¼ì§€
    'å¯…å¯…': 65, 'å¯…å¯': 25, 'å¯…è¾°': 80, 'å¯…å·³': 80, 'å¯…åˆ': 120, 'å¯…æœª': 80,
    'å¯…ç”³': -20, 'å¯…é…‰': -20, 'å¯…æˆŒ': 100, 'å¯…äº¥': 45, 'å¯…å­': 35, 'å¯…ä¸‘': 35,
    # å¯ ì¼ì§€
    'å¯å¯…': 80, 'å¯å¯': 65, 'å¯è¾°': 80, 'å¯å·³': 80, 'å¯åˆ': 45, 'å¯æœª': 120,
    'å¯ç”³': -20, 'å¯é…‰': -20, 'å¯æˆŒ': 50, 'å¯äº¥': 65, 'å¯å­': 35, 'å¯ä¸‘': 35,
    # è¾° ì¼ì§€
    'è¾°å¯…': 80, 'è¾°å¯': 80, 'è¾°è¾°': 65, 'è¾°å·³': 0, 'è¾°åˆ': 25, 'è¾°æœª': 25,
    'è¾°ç”³': 65, 'è¾°é…‰': 35, 'è¾°æˆŒ': -20, 'è¾°äº¥': 50, 'è¾°å­': 65, 'è¾°ä¸‘': 0,
    # å·³ ì¼ì§€
    'å·³å¯…': 80, 'å·³å¯': 80, 'å·³è¾°': -20, 'å·³å·³': 65, 'å·³åˆ': 0, 'å·³æœª': 35,
    'å·³ç”³': 35, 'å·³é…‰': 100, 'å·³æˆŒ': 35, 'å·³äº¥': -20, 'å·³å­': 35, 'å·³ä¸‘': 100,
    # åˆ ì¼ì§€
    'åˆå¯…': 100, 'åˆå¯': 80, 'åˆè¾°': -20, 'åˆå·³': 35, 'åˆåˆ': 20, 'åˆæœª': 35,
    'åˆç”³': 45, 'åˆé…‰': 35, 'åˆæˆŒ': 120, 'åˆäº¥': 45, 'åˆå­': 25, 'åˆä¸‘': 80,
    # æœª ì¼ì§€
    'æœªå¯…': 80, 'æœªå¯': 100, 'æœªè¾°': 25, 'æœªå·³': 35, 'æœªåˆ': 35, 'æœªæœª': 55,
    'æœªç”³': 80, 'æœªé…‰': 45, 'æœªæˆŒ': 35, 'æœªäº¥': 120, 'æœªå­': 100, 'æœªä¸‘': 35,
    # ç”³ ì¼ì§€
    'ç”³å¯…': 45, 'ç”³å¯': 35, 'ç”³è¾°': 100, 'ç”³å·³': 35, 'ç”³åˆ': 45, 'ç”³æœª': 45,
    'ç”³ç”³': 65, 'ç”³é…‰': 50, 'ç”³æˆŒ': 35, 'ç”³äº¥': 45, 'ç”³å­': 100, 'ç”³ä¸‘': 35,
    # é…‰ ì¼ì§€
    'é…‰å¯…': 35, 'é…‰å¯': 35, 'é…‰è¾°': 35, 'é…‰å·³': 100, 'é…‰åˆ': 35, 'é…‰æœª': 35,
    'é…‰ç”³': 35, 'é…‰é…‰': 55, 'é…‰æˆŒ': 35, 'é…‰äº¥': 35, 'é…‰å­': 35, 'é…‰ä¸‘': 100,
    # æˆŒ ì¼ì§€
    'æˆŒå¯…': 120, 'æˆŒå¯': 35, 'æˆŒè¾°': 0, 'æˆŒå·³': 45, 'æˆŒåˆ': 120, 'æˆŒæœª': 25,
    'æˆŒç”³': 80, 'æˆŒé…‰': 45, 'æˆŒæˆŒ': 65, 'æˆŒäº¥': 45, 'æˆŒå­': 45, 'æˆŒä¸‘': 25,
    # äº¥ ì¼ì§€
    'äº¥å¯…': 80, 'äº¥å¯': 120, 'äº¥è¾°': 35, 'äº¥å·³': 0, 'äº¥åˆ': 35, 'äº¥æœª': 120,
    'äº¥ç”³': 45, 'äº¥é…‰': 45, 'äº¥æˆŒ': 100, 'äº¥äº¥': 65, 'äº¥å­': 70, 'äº¥ä¸‘': 25,
    # å­ ì¼ì§€
    'å­å¯…': 80, 'å­å¯': 80, 'å­è¾°': 100, 'å­å·³': 45, 'å­åˆ': 25, 'å­æœª': 35,
    'å­ç”³': 100, 'å­é…‰': 45, 'å­æˆŒ': 35, 'å­äº¥': 35, 'å­å­': 20, 'å­ä¸‘': 0,
    # ä¸‘ ì¼ì§€
    'ä¸‘å¯…': 80, 'ä¸‘å¯': 80, 'ä¸‘è¾°': 25, 'ä¸‘å·³': 100, 'ä¸‘åˆ': 100, 'ä¸‘æœª': 25,
    'ä¸‘ç”³': 45, 'ä¸‘é…‰': 80, 'ä¸‘æˆŒ': 25, 'ä¸‘äº¥': 45, 'ä¸‘å­': 80, 'ä¸‘ä¸‘': 65,
}

# 3. ì¡°í›„ ì ìˆ˜ í…Œì´ë¸” (í™˜ê²½, 50% ë¹„ì¤‘) - ì›”ì§€ vs. ìš´ì§€ì§€
# ì›ë³¸ ì ìˆ˜ ë²”ìœ„: 0 ~ 100
JOHU_SCORES_LOOKUP = {
    # å¯… ì›”ì§€ (1ì›”, ë´„ ì‹œì‘)
    'å¯…å¯…': 75, 'å¯…å¯': 75, 'å¯…è¾°': 75, 'å¯…å·³': 90, 'å¯…åˆ': 100, 'å¯…æœª': 90,
    'å¯…ç”³': 0, 'å¯…é…‰': 0, 'å¯…æˆŒ': 0, 'å¯…äº¥': 0, 'å¯…å­': 0, 'å¯…ä¸‘': 0,
    # å¯ ì›”ì§€ (2ì›”)
    'å¯å¯…': 75, 'å¯å¯': 75, 'å¯è¾°': 75, 'å¯å·³': 100, 'å¯åˆ': 100, 'å¯æœª': 100,
    'å¯ç”³': 35, 'å¯é…‰': 35, 'å¯æˆŒ': 35, 'å¯äº¥': 35, 'å¯å­': 35, 'å¯ä¸‘': 35,
    # è¾° ì›”ì§€ (3ì›”)
    'è¾°å¯…': 75, 'è¾°å¯': 75, 'è¾°è¾°': 75, 'è¾°å·³': 75, 'è¾°åˆ': 75, 'è¾°æœª': 75,
    'è¾°ç”³': 75, 'è¾°é…‰': 75, 'è¾°æˆŒ': 35, 'è¾°äº¥': 35, 'è¾°å­': 35, 'è¾°ä¸‘': 35,
    # å·³ ì›”ì§€ (4ì›”, ì—¬ë¦„ ì‹œì‘)
    'å·³å¯…': 60, 'å·³å¯': 60, 'å·³è¾°': 60, 'å·³å·³': 35, 'å·³åˆ': 35, 'å·³æœª': 35,
    'å·³ç”³': 60, 'å·³é…‰': 60, 'å·³æˆŒ': 60, 'å·³äº¥': 75, 'å·³å­': 75, 'å·³ä¸‘': 75,
    # åˆ ì›”ì§€ (5ì›”)
    'åˆå¯…': 90, 'åˆå¯': 60, 'åˆè¾°': 60, 'åˆå·³': 35, 'åˆåˆ': 35, 'åˆæœª': 35,
    'åˆç”³': 75, 'åˆé…‰': 75, 'åˆæˆŒ': 75, 'åˆäº¥': 100, 'åˆå­': 100, 'åˆä¸‘': 100,
    # æœª ì›”ì§€ (6ì›”)
    'æœªå¯…': 60, 'æœªå¯': 60, 'æœªè¾°': 60, 'æœªå·³': 35, 'æœªåˆ': 35, 'æœªæœª': 35,
    'æœªç”³': 60, 'æœªé…‰': 60, 'æœªæˆŒ': 35, 'æœªäº¥': 100, 'æœªå­': 100, 'æœªä¸‘': 75,
    # ç”³ ì›”ì§€ (7ì›”, ê°€ì„ ì‹œì‘)
    'ç”³å¯…': 75, 'ç”³å¯': 75, 'ç”³è¾°': 75, 'ç”³å·³': 100, 'ç”³åˆ': 100, 'ç”³æœª': 100,
    'ç”³ç”³': 35, 'ç”³é…‰': 35, 'ç”³æˆŒ': 75, 'ç”³äº¥': 35, 'ç”³å­': 35, 'ç”³ä¸‘': 35,
    # é…‰ ì›”ì§€ (8ì›”)
    'é…‰å¯…': 60, 'é…‰å¯': 60, 'é…‰è¾°': 60, 'é…‰å·³': 100, 'é…‰åˆ': 100, 'é…‰æœª': 100,
    'é…‰ç”³': 35, 'é…‰é…‰': 35, 'é…‰æˆŒ': 35, 'é…‰äº¥': 35, 'é…‰å­': 35, 'é…‰ä¸‘': 35,
    # æˆŒ ì›”ì§€ (9ì›”)
    'æˆŒå¯…': 60, 'æˆŒå¯': 60, 'æˆŒè¾°': 60, 'æˆŒå·³': 75, 'æˆŒåˆ': 75, 'æˆŒæœª': 75,
    'æˆŒç”³': 60, 'æˆŒé…‰': 60, 'æˆŒæˆŒ': 60, 'æˆŒäº¥': 35, 'æˆŒå­': 35, 'æˆŒä¸‘': 35,
    # äº¥ ì›”ì§€ (10ì›”, ê²¨ìš¸ ì‹œì‘)
    'äº¥å¯…': 60, 'äº¥å¯': 60, 'äº¥è¾°': 60, 'äº¥å·³': 100, 'äº¥åˆ': 100, 'äº¥æœª': 100,
    'äº¥ç”³': 35, 'äº¥é…‰': 35, 'äº¥æˆŒ': 90, 'äº¥äº¥': 20, 'äº¥å­': 20, 'äº¥ä¸‘': 20,
    # å­ ì›”ì§€ (11ì›”)
    'å­å¯…': 60, 'å­å¯': 60, 'å­è¾°': 60, 'å­å·³': 100, 'å­åˆ': 100, 'å­æœª': 100,
    'å­ç”³': 35, 'å­é…‰': 35, 'å­æˆŒ': 100, 'å­äº¥': 20, 'å­å­': 20, 'å­ä¸‘': 20,
    # ä¸‘ ì›”ì§€ (12ì›”)
    'ä¸‘å¯…': 75, 'ä¸‘å¯': 75, 'ä¸‘è¾°': 75, 'ä¸‘å·³': 100, 'ä¸‘åˆ': 100, 'ä¸‘æœª': 100,
    'ä¸‘ç”³': 35, 'ä¸‘é…‰': 35, 'ä¸‘æˆŒ': 75, 'ä¸‘äº¥': 20, 'ä¸‘å­': 20, 'ä¸‘ä¸‘': 20,
}

# 4. ì‹ ì •ì¡°í›„ ì ìˆ˜ í…Œì´ë¸” (è¾›/ä¸ ì „ìš©, 40% ë¹„ì¤‘) - ìš´ì§€ì§€ë§Œ ì°¸ì¡° (ì›”ì§€ ë¬´ê´€)
# ì›ë³¸ ì ìˆ˜ ë²”ìœ„: 35 ~ 75
# í•µì‹¬: ì—¬ë¦„(å·³åˆæœª) = 35 (ë‚˜ì¨), ê²¨ìš¸(äº¥å­ä¸‘) = 75 (ì¢‹ìŒ), ë´„ê°€ì„ = 60~75 (ë³´í†µ)
SINJEONG_JOHU_SCORES_LOOKUP = {
    # ë´„ (å¯…å¯è¾°)
    'å¯…': 60, 'å¯': 60, 'è¾°': 60,
    # ì—¬ë¦„ (å·³åˆæœª) - ê°€ì¥ ë‚˜ì¨
    'å·³': 35, 'åˆ': 35, 'æœª': 35,
    # ê°€ì„ (ç”³é…‰æˆŒ)
    'ç”³': 60, 'é…‰': 60, 'æˆŒ': 75,
    # ê²¨ìš¸ (äº¥å­ä¸‘) - ê°€ì¥ ì¢‹ìŒ
    'äº¥': 75, 'å­': 75, 'ä¸‘': 75,
}


# --------------------------------------------------------------------------------
# 4.2. ì •ê·œí™” í•¨ìˆ˜ (Normalization Functions)
# ëª¨ë“  ì ìˆ˜ë¥¼ 0~100 ë²”ìœ„ë¡œ ë³€í™˜
# --------------------------------------------------------------------------------

def normalize_cheongan_score(raw_score: float) -> float:
    """
    ì²œê°„ ì ìˆ˜ ì •ê·œí™”: -10 ~ 100 â†’ 0 ~ 100
    ê³µì‹: (ì›ë³¸ + 10) / 110 * 100
    """
    return (raw_score + 10) / 110 * 100

def normalize_jiji_score(raw_score: float) -> float:
    """
    ì§€ì§€ ì ìˆ˜ ì •ê·œí™”: -20 ~ 120 â†’ 0 ~ 100
    ê³µì‹: (ì›ë³¸ + 20) / 140 * 100
    """
    return (raw_score + 20) / 140 * 100

def normalize_johu_score(raw_score: float) -> float:
    """
    ì¡°í›„ ì ìˆ˜ ì •ê·œí™”: 0 ~ 100 â†’ ê·¸ëŒ€ë¡œ ì‚¬ìš©
    """
    return raw_score

def normalize_sinjeong_score(raw_score: float) -> float:
    """
    ì‹ ì •ì¡°í›„ ì ìˆ˜ ì •ê·œí™”: 35 ~ 75 â†’ 0 ~ 100
    ê³µì‹: (ì›ë³¸ - 35) / 40 * 100
    """
    return (raw_score - 35) / 40 * 100


# --------------------------------------------------------------------------------
# 4.3. ë³´ì¡° í•¨ìˆ˜ (Helper Functions for Logic)
# --------------------------------------------------------------------------------

# ì§€ì§€ ì˜¤í–‰ ë§¤í•‘ (í†  ì§€ì§€ ë‚´ì¥ ì˜¤í–‰ ë¯¸í¬í•¨, ëŒ€í‘œ ì˜¤í–‰ ê¸°ì¤€)
JIJI_O_HENG = {
    'å¯…': 'æœ¨', 'å¯': 'æœ¨', 'è¾°': 'åœŸ', 'å·³': 'ç«', 'åˆ': 'ç«', 'æœª': 'åœŸ', 
    'ç”³': 'é‡‘', 'é…‰': 'é‡‘', 'æˆŒ': 'åœŸ', 'äº¥': 'æ°´', 'å­': 'æ°´', 'ä¸‘': 'åœŸ'
}

def get_oheng(jiji: str) -> str:
    """ì§€ì§€ ê¸€ìì˜ ëŒ€í‘œ ì˜¤í–‰ì„ ë°˜í™˜ (Returns the representative element of the earthly branch)"""
    return JIJI_O_HENG.get(jiji, '')

def check_geuk(oheng1: str, oheng2: str) -> bool:
    """ì˜¤í–‰1ì´ ì˜¤í–‰2ë¥¼ ê·¹(å‰‹)í•˜ëŠ”ì§€ í™•ì¸ (Checks if Element 1 clashes with Element 2)"""
    geuk_map = {
        'æœ¨': 'åœŸ', 'ç«': 'é‡‘', 'åœŸ': 'æ°´', 'é‡‘': 'æœ¨', 'æ°´': 'ç«'
    }
    return geuk_map.get(oheng1) == oheng2

def get_cheongan_score(ilgan: str, un_cheongan: str) -> float:
    """
    ì²œê°„ ì›ë³¸ ì ìˆ˜ ì¡°íšŒ (ì¼ê°„ vs ìš´ì²œê°„)
    ë°˜í™˜: ì›ë³¸ ì ìˆ˜ (-10 ~ 100), ê¸°ë³¸ê°’ 50
    """
    return CHUNGAN_SCORES_LOOKUP.get((ilgan, un_cheongan), 50.0)

def get_jiji_score(ilji: str, un_jiji: str) -> float:
    """
    ì§€ì§€ ì›ë³¸ ì ìˆ˜ ì¡°íšŒ (ì¼ì§€ vs ìš´ì§€ì§€)
    ë°˜í™˜: ì›ë³¸ ì ìˆ˜ (-20 ~ 120), ê¸°ë³¸ê°’ 50
    """
    key = ilji + un_jiji
    return JIJI_SCORES_LOOKUP.get(key, 50.0)

def get_johu_score(wolji: str, un_jiji: str) -> float:
    """
    ì¡°í›„ ì›ë³¸ ì ìˆ˜ ì¡°íšŒ (ì›”ì§€ vs ìš´ì§€ì§€)
    ë°˜í™˜: ì›ë³¸ ì ìˆ˜ (0 ~ 100), ê¸°ë³¸ê°’ 50
    """
    key = wolji + un_jiji
    return JOHU_SCORES_LOOKUP.get(key, 50.0)

def get_sinjeong_score(un_jiji: str) -> float:
    """
    ì‹ ì •ì¡°í›„ ì›ë³¸ ì ìˆ˜ ì¡°íšŒ (ìš´ì§€ì§€ë§Œ ì°¸ì¡°, è¾›/ä¸ ì¼ê°„ ì „ìš©)
    ë°˜í™˜: ì›ë³¸ ì ìˆ˜ (35 ~ 75), ê¸°ë³¸ê°’ 60
    """
    return SINJEONG_JOHU_SCORES_LOOKUP.get(un_jiji, 60.0)


# --------------------------------------------------------------------------------
# 4.4. ìµœì¢… ìš´ì„¸ ì ìˆ˜ ê³„ì‚° í•¨ìˆ˜ (Total Luck Score Calculation)
# ğŸ”„ ì—…ë°ì´íŠ¸: ì •ê·œí™” ë¡œì§ ì ìš©
# --------------------------------------------------------------------------------

def calculate_total_luck_score(sa_ju_data: dict, luck_data: dict) -> dict:
    """
    í™•ì •ëœ ê°€ì¤‘ì¹˜ì™€ ì •ê·œí™”ë¥¼ ì‚¬ìš©í•˜ì—¬ ìµœì¢… ì¢…í•© ìš´ì„¸ ì ìˆ˜(0~100)ë¥¼ ì‚°ì¶œí•©ë‹ˆë‹¤.
    
    ê°€ì¤‘ì¹˜:
    - ì¼ë°˜ ì¼ê°„: ì²œê°„(20%) + ì§€ì§€(30%) + ì¡°í›„(50%)
    - è¾›/ä¸ ì¼ê°„: ì²œê°„(20%) + ì§€ì§€(30%) + ì¡°í›„(10%) + ì‹ ì •ì¡°í›„(40%)
    
    Parameters:
    - sa_ju_data: {'ì¼ê°„': 'è¾›', 'ì›”ì§€': 'åˆ', 'ì¼ì§€': 'å­'}
    - luck_data: {'ì²œê°„': 'å£¬', 'ì§€ì§€': 'å¯…', 'ìš´ì˜ì¢…ë¥˜': 'ëŒ€ìš´'}
    
    Returns:
    - dict: ê°œë³„ ì ìˆ˜ ë° ì´ì  (ëª¨ë‘ 0~100 ë²”ìœ„)
    """
    ilgan = sa_ju_data.get('ì¼ê°„', '')
    wolji = sa_ju_data.get('ì›”ì§€', '')
    ilji = sa_ju_data.get('ì¼ì§€', '')
    luck_cheongan = luck_data.get('ì²œê°„', '')
    luck_jiji = luck_data.get('ì§€ì§€', '')

    # 1. ì›ë³¸ ì ìˆ˜ ì¡°íšŒ
    raw_cheongan = get_cheongan_score(ilgan, luck_cheongan)
    raw_jiji = get_jiji_score(ilji, luck_jiji)
    raw_johu = get_johu_score(wolji, luck_jiji)
    
    # 2. ì •ê·œí™” (0~100 ë²”ìœ„ë¡œ ë³€í™˜)
    norm_cheongan = normalize_cheongan_score(raw_cheongan)
    norm_jiji = normalize_jiji_score(raw_jiji)
    norm_johu = normalize_johu_score(raw_johu)
    
    # 3. è¾›/ä¸ ì¼ê°„ ì—¬ë¶€ì— ë”°ë¥¸ ìµœì¢… ì ìˆ˜ ê³„ì‚°
    is_sin_or_jeong = ilgan in ['è¾›', 'ä¸']
    
    if is_sin_or_jeong:
        # è¾›/ä¸ ì¼ê°„: ì²œê°„(20%) + ì§€ì§€(30%) + ì¡°í›„(10%) + ì‹ ì •ì¡°í›„(40%)
        raw_sinjeong = get_sinjeong_score(luck_jiji)
        norm_sinjeong = normalize_sinjeong_score(raw_sinjeong)
        
        total = (
            norm_cheongan * 0.20 +
            norm_jiji * 0.30 +
            norm_johu * 0.10 +
            norm_sinjeong * 0.40
        )
        
        return {
            'cheongan': round(norm_cheongan, 2),      # ê³„íš
            'jiji': round(norm_jiji, 2),              # ê²°ê³¼
            'johu': round(norm_johu, 2),              # í™˜ê²½
            'sinjeong': round(norm_sinjeong, 2),      # ì‹ ì •í™˜ê²½
            'total': round(total, 2),                 # ì´ì 
            'is_sin_or_jeong': True,
            # ì›ë³¸ ì ìˆ˜ (ë””ë²„ê¹…ìš©)
            'raw_cheongan': raw_cheongan,
            'raw_jiji': raw_jiji,
            'raw_johu': raw_johu,
            'raw_sinjeong': raw_sinjeong,
        }
    else:
        # ì¼ë°˜ ì¼ê°„: ì²œê°„(20%) + ì§€ì§€(30%) + ì¡°í›„(50%)
        total = (
            norm_cheongan * 0.20 +
            norm_jiji * 0.30 +
            norm_johu * 0.50
        )
        
        return {
            'cheongan': round(norm_cheongan, 2),      # ê³„íš
            'jiji': round(norm_jiji, 2),              # ê²°ê³¼
            'johu': round(norm_johu, 2),              # í™˜ê²½
            'sinjeong': None,                         # í•´ë‹¹ì—†ìŒ
            'total': round(total, 2),                 # ì´ì 
            'is_sin_or_jeong': False,
            # ì›ë³¸ ì ìˆ˜ (ë””ë²„ê¹…ìš©)
            'raw_cheongan': raw_cheongan,
            'raw_jiji': raw_jiji,
            'raw_johu': raw_johu,
            'raw_sinjeong': None,
        }


def calculate_fortune_timeline(sa_ju_data: dict, fortune_list: list) -> list:
    """
    ì—¬ëŸ¬ ìš´(ëŒ€ìš´/ì„¸ìš´/ì›”ìš´/ì¼ìš´)ì˜ ì ìˆ˜ë¥¼ ì¼ê´„ ê³„ì‚°
    
    Parameters:
    - sa_ju_data: {'ì¼ê°„': 'è¾›', 'ì›”ì§€': 'åˆ', 'ì¼ì§€': 'å­'}
    - fortune_list: [{'name': 'ëŒ€ìš´1', 'cheongan': 'ç”²', 'jiji': 'å¯…'}, ...]
    
    Returns:
    - list: ê° ìš´ì˜ ì ìˆ˜ ê²°ê³¼ ë¦¬ìŠ¤íŠ¸
    """
    results = []
    for fortune in fortune_list:
        luck_data = {
            'ì²œê°„': fortune.get('cheongan', fortune.get('ì²œê°„', '')),
            'ì§€ì§€': fortune.get('jiji', fortune.get('ì§€ì§€', '')),
            'ìš´ì˜ì¢…ë¥˜': fortune.get('type', fortune.get('ìš´ì˜ì¢…ë¥˜', ''))
        }
        
        score = calculate_total_luck_score(sa_ju_data, luck_data)
        score['name'] = fortune.get('name', '')
        score['un_cheongan'] = luck_data['ì²œê°„']
        score['un_jiji'] = luck_data['ì§€ì§€']
        score['un_type'] = luck_data['ìš´ì˜ì¢…ë¥˜']
        results.append(score)
    
    return results


# --------------------------------------------------------------------------------
# 4.5. íŠ¹ìˆ˜ êµ¬ì¡° í•´ì„ í”Œë˜ê·¸ í•¨ìˆ˜ (Interpretation Flags) - ê¸°ì¡´ ìœ ì§€
# --------------------------------------------------------------------------------

def generate_interpretation_flags(sa_ju_data: dict, luck_data: dict, child_data: dict = None) -> dict:
    """
    ì ìˆ˜ ì™¸ì˜ íŠ¹ìˆ˜ êµ¬ì¡° ë° ê´€ê³„/ê±´ê°• ê´€ë ¨ í•´ì„ í”Œë˜ê·¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
    (Generates interpretation flags for AI prompt injection.)
    """
    flags = {}
    wol_jiji = sa_ju_data.get('ì›”ì§€', '')
    il_jiji = sa_ju_data.get('ì¼ì§€', '')
    si_jiji = sa_ju_data.get('ì‹œì§€', '')
    
    # A. í†  ì›”ì§€ ì„ ìš©ì‹  í”Œë˜ê·¸ (è¾°æˆŒä¸‘æœª)
    if wol_jiji in ['è¾°', 'æˆŒ', 'ä¸‘', 'æœª']:
        flags['ìš©ì‹ _ì„ ìˆœìœ„'] = "åœŸ ì›”ì§€: æœ¨(ëª©) ì„  ìš©ì‹  ì ìš©. êµ¬ì¡°í™” ë° ìˆ˜ìµí™”ì— í•„ìš”í•œ ì‹œì‘ì˜ í˜(æœ¨)ì„ ì¤‘ì  í‰ê°€."
    
    # B. ìœ„ì¹˜ ê¸°ë°˜ í•´ì„ (AI ë¶„ì„ í”„ë¡¬í”„íŠ¸ì— í™œìš©)
    flags['ì‚¬ì—…_íˆ¬ì_ê´€ì '] = f"ì‹œ ì§€ì§€({si_jiji})ì™€ ìš´({luck_data.get('ì§€ì§€', '')})ì˜ ìƒí˜¸ì‘ìš© ë¶„ì„"
    flags['ê±°ì£¼_ê²°í˜¼_ê´€ì '] = f"ì¼ ì§€ì§€({il_jiji})ì™€ ìš´({luck_data.get('ì§€ì§€', '')})ì˜ ìƒí˜¸ì‘ìš© ë¶„ì„"
    
    # C. ë°°ìš°ì ê±´ê°• ìœ„í—˜ í”Œë˜ê·¸ (ì‹œ/ì›” ì§€ì§€ê°€ ì¼ ì§€ì§€ë¥¼ ë™ì‹œì— ê·¹í•  ë•Œ)
    oheng_si = get_oheng(si_jiji)
    oheng_wol = get_oheng(wol_jiji)
    oheng_il = get_oheng(il_jiji)
    
    # ì‹œì™€ ì›”ì˜ ì˜¤í–‰ì´ ê°™ê³ , ê·¸ ì˜¤í–‰ì´ ì¼ì§€ë¥¼ ê·¹í•˜ëŠ” ê²½ìš°
    if oheng_si and oheng_wol and oheng_il:
        if oheng_si == oheng_wol and check_geuk(oheng_si, oheng_il):
            flags['ë°°ìš°ì_ê±´ê°•_ìœ„í—˜'] = "ì‹œ/ì›” ì§€ì§€ì˜ ë™ì‹œ ê·¹ìœ¼ë¡œ ì¸í•œ ì¼ì§€ í”¼ê·¹. ë°°ìš°ì ê±´ê°• ì£¼ì˜ ë° ë¬¼ë¦¬ì  ê±°ë¦¬ ê¶Œì¥."
        
    # D. ìë…€ ì²œê°„í•© í”Œë˜ê·¸ (ëŒ€ìš´ì— í•œí•´)
    if child_data and luck_data.get('ìš´ì˜ì¢…ë¥˜') == 'ëŒ€ìš´':
        pass 
    
    return flags


# --------------------------------------------------------------------------------
# 4.6. í•˜ìœ„ í˜¸í™˜ì„± ìœ ì§€ í•¨ìˆ˜ (Legacy Support)
# ê¸°ì¡´ ì½”ë“œì—ì„œ ì‚¬ìš©í•˜ë˜ í•¨ìˆ˜ëª…/êµ¬ì¡° ìœ ì§€
# --------------------------------------------------------------------------------

def get_jiji_interaction_score(jiji1: str, jiji2: str, score_type: str) -> float:
    """
    [í•˜ìœ„ í˜¸í™˜ì„±] ê¸°ì¡´ ì½”ë“œ í˜¸í™˜ìš© - ì§€ì§€ ì ìˆ˜ ì¡°íšŒ
    score_type: 'Result_Jiji', 'General_ChoHou', 'ShinJung_ChoHou'
    """
    key = jiji1 + jiji2
    
    if score_type == 'Result_Jiji':
        return JIJI_SCORES_LOOKUP.get(key, 50.0)
    elif score_type == 'General_ChoHou':
        return JOHU_SCORES_LOOKUP.get(key, 50.0)
    elif score_type == 'ShinJung_ChoHou':
        return SINJEONG_JOHU_SCORES_LOOKUP.get(jiji2, 60.0)
    else:
        return 50.0
